#include <windows.h>
#include <iostream>
#include <Lmcons.h>

std::string get_username()
{
    // Snippet to get the current username
    TCHAR username[UNLEN + 1];
    DWORD username_len = UNLEN + 1;
    GetUserName(username, &username_len);
    std::wstring username_w(username);
    std::string username_s(username_w.begin(), username_w.end());
    return username_s;
    
}

int main(int argc, char** argv)
{
    // Printing Curent Username
    printf("[+] Current user is: %s\n", (get_username()).c_str());
    // Grab PID from command line argument of the process you want open
    
    char *pid_c = argv[1];
    DWORD PID = atoi(pid_c);
    // Call OpenProcess(), print return code and error code
    //dwDesiredAccess à PROCESS_QUERY_INFORMATION: Required to retrieve certain information about a process, such as its token, exit code, and priority class
    //bInheritHandle à True: Processes created by this process will inherit the handle
    //dwProcessId à Process ID to be provided as user input
    HANDLE processHandle = OpenProcess(PROCESS_QUERY_LIMITED_INFORMATION, true, PID);
    if (GetLastError() == NULL) {
        printf("[+] OpenProcess() success!\n");
    }  else{
        printf("[-] OpenProcess() Return Code: %i\n", processHandle);
        printf("[-] OpenProcess() Error: %i\n", GetLastError());
    } 
    return 0;
}